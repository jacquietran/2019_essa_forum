---
title: "Data analytics in exercise & sport"
date: "Dr Jacquie Tran &nbsp; | &nbsp; @jacquietran | &nbsp; 4 May 2019"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---

```{r setup, include=FALSE}

options(htmltools.dir.version = FALSE)

# Load libraries ---------------------------------------------------------------

library(here)
library(ghibli)
library(xaringanthemer)

```

```{r xaringan_themer, include = FALSE}

mono_light(
  base_color = ghibli_palette("MononokeDark")[3],
  header_font_google = google_font("Walter Turncoat"),
  header_h1_font_size = "65px",
  header_h2_font_size = "50px",
  header_h3_font_size = "40px",
  # header_font_weight = "bold",
  text_font_google   = google_font("Montserrat", "400", "400i", "400b"),
  text_font_size = "26px",
  code_font_google   = google_font("Droid Mono"),
  padding = "0em 2em 1em 2em",
  footnote_color = "#666666",
  footnote_font_size = "0.5em",
  footnote_position_bottom = "0.5em"
)

```

class: inverse, center, middle

# 'Start with the end in mind.'

---

<br />
<br />

What is the **decision** in need of evidence? (the motivating question)

--

How will you make the decision with **no additional information**?

--

How would you make the decision if you had access to **any information you wanted**?

--

Can you get **access** to all the data you ideally want to make your decision?

--

What **mistakes** are you willing to live with?

--

.footnote[
[1] Argyris, 1976, ['Single-loop and double-loop models in research on decision-making'](http://academic.udayton.edu/richardghere/igo%20ngo%20research/argyris.pdf), _Administrative Science Quarterly_.

[2] Byrne, 2018, ['Why Google defind a new discipline to help humans make decisions'](https://www.fastcompany.com/90203073/why-google-defined-a-new-discipline-to-help-humans-make-decisions), _Fast Company_.
]

---
class: inverse, center, middle

# Coding with data

---

## Excel: Its power and its pitfalls

--

1. Data, analysis outputs, and visualisation are **stored in one file**.

--

2. Data is **easily manipulated** - high risk of introducing errors.

--

3. Point-and-click interface - **manual repetition!**

--

4. **Actions are not logged** by default.

--

5. **Slow** when working with large data sets or files storing many computations.

--

6. Complicated **workbooks can 'break' when shared** with others.

---
class: inverse, center, middle

<img src="https://raw.githubusercontent.com/jacquietran/2019_essa_forum/master/images/excel_stopped_working.png" width = "700px" />

---

## The case for coding

--

1. **Separation** of data, analysis outputs, visualisations, and reports.

--

2. **Reproducible**, transparent, and less error-prone workflow.

--

3. Coding methods are **faster** than point-and-click as your **data gets bigger**, your **actions more repetitive**, and your **analyses more sophisticated**.

--

4. Procedures are **documented** via scripts and command history.

--

5. **Build your own library** of frequently used analytical procedures - or use and adapt libraries created by open source developers!

---
class: inverse, center, middle

# A tidy workflow

---
class: center, middle

![](https://raw.githubusercontent.com/jacquietran/2019_essa_forum/master/images/tidy_workflow.png)

Grolemund & Wickham, 2017, **[R for Data Science](https://r4ds.had.co.nz/)**

---
class: inverse, center, middle

# Worked example with sports data
## Winter Olympics medallists 1924â€“2014

---

<br />
This example uses a publicly available data set that includes **all podium results from the Winter Olympic Games from 1924 to 2014, inclusive**.

<center>
<img src="https://raw.githubusercontent.com/jacquietran/2019_essa_forum/master/images/ChloeKim.jpg" width="600px" />
</center>

--

The `winter` data set is downloadable from this link:  
**[https://www.kaggle.com/the-guardian/olympic-games/data](https://www.kaggle.com/the-guardian/olympic-games/data)**

---
class: inverse, center, middle

# 'Start with the end in mind.'

---
class: center, middle

## **How many gold medals** were won by
## **Canada, Norway, and Sweden** at the
## **last five Winter Olympic Games**, up to 2014?

---

<br />
To answer this question, we will use R to create this **data table**...

![](https://raw.githubusercontent.com/jacquietran/2019_essa_forum/master/images/demo1_data_table.PNG)

---

<br />
...and this **data plot**!

---

## Import the data

``` {r demo1_import_data_part_1, message = FALSE}

# The {readr} package is efficient for reading (importing) CSVs
library(readr)

# Import the data into your R session
winter <- read_csv(
  here("data/winter.csv"), col_names = TRUE, col_types = NULL)

```

---

## Import the data

``` {r demo1_import_data_part_2, eval = FALSE}

# The {readr} package is efficient for reading (importing) CSVs
library(readr) #<<

# Import the data into your R session
winter <- read_csv(
  here("data/winter.csv"), col_names = TRUE, col_types = NULL)

```

---

## Import the data

``` {r demo1_import_data_part_3, eval = FALSE}

# The {readr} package is efficient for reading (importing) CSVs
library(readr)

# Import the data into your R session
winter <- read_csv(                                            #<<
  here("data/winter.csv"), col_names = TRUE, col_types = NULL) #<<

```

---

## Check the data

``` {r demo1_check_data, eval = FALSE}

head(winter)

```

--

``` {r demo1_check_data_eval, eval = TRUE, echo = FALSE}

# This code chunk won't show on the slide but
# the code will evaluate to print the first 6 rows of data
# allowing for separation of the code chunk from its result
head(winter)

```

---

## Subset the data

Remember our motivating question: **How many gold medals** were won by **Canada, Norway, and Sweden** at the **last five Winter Olympic Games**, up to 2014?

--

We need to subset the data to focus only on:

- Gold medal results

--

- Athletes from Canada (CAN), Norway (NOR), or Sweden (SWE), and

--

- Results from the five Winter Olympics between 1998 to 2014, inclusive.

---

## Subset the data

``` {r demo1_subset_data_part_1, warning = FALSE, message = FALSE}

# The {dplyr} package includes useful data manipulation functions
library(dplyr) #<<

# Subset the data
gold_medal_comparison <- winter %>%
  filter(Medal == "Gold"
         & Country %in% c("CAN", "NOR", "SWE")
         & Year >= 1998)

```

---

## Subset the data

``` {r demo1_subset_data_part_2, eval = FALSE}

# The {dplyr} package includes useful data manipulation functions
library(dplyr)

# Subset the data
gold_medal_comparison <- winter %>%            #<<
  filter(Medal == "Gold"
         & Country %in% c("CAN", "NOR", "SWE")
         & Year >= 1998)

```

---

## Subset the data

``` {r demo1_subset_data_part_3, eval = FALSE}

# The {dplyr} package includes useful data manipulation functions
library(dplyr)

# Subset the data
gold_medal_comparison <- winter %>%
  filter(Medal == "Gold"                       #<<
         & Country %in% c("CAN", "NOR", "SWE") #<<
         & Year >= 1998)                       #<<

```

---

## Check the data

``` {r demo1_check_subset}

head(gold_medal_comparison,
     n = 9) #<<

```

---

## Wrangle the data

In the `winter` data set, the data is structured such that **one row is one medal-winning athlete**.

However...

--

- Team events (e.g., bobsleigh, curling) comprise multiple athletes, and

--

- Within teams that achieve a podium finish, each athlete is awarded a medal.

--

For this analysis, we need to wrangle the data to get it into a format where **one row represents one gold medal per event** (rather than per athlete).

---

## Wrangle the data

``` {r demo1_wrangle_data_part_1}

# Create a new variable to identify each unique event
gold_medal_comparison$unique_event_ID <- #<<
  paste(gold_medal_comparison$Year,
        gold_medal_comparison$Sport,
        gold_medal_comparison$Discipline,
        gold_medal_comparison$Country,
        gold_medal_comparison$Gender,
        gold_medal_comparison$Event,
        sep = "_")

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_2, eval = FALSE}

# Create a new variable to identify each unique event
gold_medal_comparison$unique_event_ID <-
  paste(gold_medal_comparison$Year,           #<<
        gold_medal_comparison$Sport,          #<<
        gold_medal_comparison$Discipline,     #<<
        gold_medal_comparison$Country,        #<<
        gold_medal_comparison$Gender,         #<<
        gold_medal_comparison$Event,          #<<
        sep = "_")                            #<<

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_3a, eval = FALSE}

gold_medal_comparison %>%
  select(unique_event_ID) #<<

```

--

``` {r demo1_wrangle_data_part_3b, echo = FALSE}

# This code chunk will evaluate but not display
gold_medal_comparison %>%
  select(unique_event_ID)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_3c, highlight.output = c(6,7)}

gold_medal_comparison %>%
  select(unique_event_ID)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_3d, highlight.output = c(8:12)}

gold_medal_comparison %>%
  select(unique_event_ID)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_4a, eval = FALSE}

# Identify duplicates
gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>% #<<
  select(unique_event_ID, duplicates) %>%
  head(n = 7)

```

--

``` {r demo1_wrangle_data_part_4b, echo = FALSE}

# This code chunk will evaluate but not display

# Identify duplicates
gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  select(unique_event_ID, duplicates) %>%
  head(n = 7)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_4c, highlight.output = c(7,9,10)}

# Identify duplicates
gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  select(unique_event_ID, duplicates) %>%
  head(n = 7)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_5a, eval = FALSE}

# Remove duplicates from the data
gold_medal_comparison <- gold_medal_comparison %>%     #<<
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  filter(duplicates == FALSE) %>%
  select(Year, City, Sport, Country, Event, Medal)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_5b, eval = FALSE}

# Remove duplicates from the data
gold_medal_comparison <- gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>% #<<
  filter(duplicates == FALSE) %>%
  select(Year, City, Sport, Country, Event, Medal)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_5c, eval = FALSE}

# Remove duplicates from the data
gold_medal_comparison <- gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  filter(duplicates == FALSE) %>%                      #<<
  select(Year, City, Sport, Country, Event, Medal)     #<<

```

--

``` {r demo1_wrangle_data_part_5d, echo = FALSE}

# This code chunk will evaluate but not display

# Remove duplicates from the data
gold_medal_comparison <- gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  filter(duplicates == FALSE) %>%
  select(Year, City, Sport, Country, Event, Medal)

# Check the data
head(gold_medal_comparison)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_5e, eval = FALSE}

# Remove duplicates from the data
gold_medal_comparison <- gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  filter(duplicates == FALSE) %>%
  select(Year, City, Sport, Country, Event, Medal)

```

``` {r demo1_wrangle_data_part_5f, echo = FALSE, highlight.output = c(6)}

# Check the data
head(gold_medal_comparison)

```

---

## Wrangle the data

``` {r demo1_wrangle_data_part_5g, eval = FALSE}

# Remove duplicates from the data
gold_medal_comparison <- gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  filter(duplicates == FALSE) %>%
  select(Year, City, Sport, Country, Event, Medal)

```

``` {r demo1_wrangle_data_part_5h, echo = FALSE, highlight.output = c(7)}

# Check the data
head(gold_medal_comparison)

```

---

## Calculate summary statistics

Now that we have tidied up the data into the format we need, we can calculate the **total number of gold medals** won by **Canada, Norway, and Sweden** at each of the **Winter Games between 1998 and 2014**.

---

## Calculate summary statistics

``` {r demo1_summary_stats_part_1, message = FALSE}

# The {reshape2} package is useful for manipulating data
# from long-to-wide format and vice versa
library(reshape2)

# Calculate total number of gold medals per team per Winter Games
gold_medal_totals <- gold_medal_comparison %>%
  group_by(Year, City, Country) %>%
  summarise(gold_medal_total = length(Medal)) %>%
  ungroup()

# Reshape the data from long-to-wide format for tabulating
gold_medal_totals_wide <- dcast(
  gold_medal_totals,
  Year + City ~ Country,
  value.var = "gold_medal_total")

```

---

## Calculate summary statistics

``` {r demo1_summary_stats_part_2}

# Check the reshaped data
gold_medal_totals_wide

```

``` {r demo1_summary_stats_part_3}

# NAs appear in the data because Sweden did not win any gold medals
# at the 1998 and 2002 Winter Games

# Replace these NAs with zeroes
gold_medal_totals_wide[is.na(gold_medal_totals_wide)] <- 0

```

---

## Display summary statistics

``` {r demo1_summary_stats_part_4, eval = FALSE}

# The {DT} package is used to display interactive tables in HTML documents
library(DT)

# Display the totals in a table
datatable(gold_medal_totals_wide,
          options = list(dom = 't'), rownames = FALSE)

```

---

## Display summary statistics

``` {r demo1_summary_stats_part_5, eval = TRUE, echo = FALSE, warning = FALSE}

# This code chunk won't display on the slide but
# the code will evaluate to display summary stats
# in an interactive HTML table
library(DT)

datatable(gold_medal_totals_wide,
          fillContainer = FALSE,
          options = list(dom = 't'),
          rownames = FALSE)

```

---

## Plot the data

We can also plot the gold medal totals we've calculated, which may be more useful as a visual comparison between countries and over time.

--

To create the plot, we will use:
- The `ggplot2` R package
- The `gold_medal_totals` data that we created earlier, in long format.

--

The **gg** in `ggplot2` stands for **[Grammar of Graphics](https://ggplot2.tidyverse.org/)**, the theoretical foundation for how the package works.

---

## Plot the data

``` {r demo1_build_plot}

# The {ggplot2} package is a powerful and fully featured
# R package for creating data visualisations
library(ggplot2)

# Build the plot
p <- ggplot(data = gold_medal_totals,
            aes(x = Year, y = gold_medal_total,
                fill = Country))
p <- p + facet_wrap(~Country, nrow = 1)
p <- p + geom_bar(stat = "identity")

```

---

``` {r demo1_display_plot, echo = FALSE, fig.width = 16, fig.height = 8}

p

```

---
class: inverse, center, middle

# Developing data proficiency

---
class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).