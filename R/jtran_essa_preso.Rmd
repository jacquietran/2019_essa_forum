---
title: "Data analytics in exercise and sport"
subtitle: "<br />Dr Jacquie Tran"
author: "@jacquietran --- ESSA Forum, 4 May 2019"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---

```{r setup, include=FALSE}

options(htmltools.dir.version = FALSE)

# Load libraries ---------------------------------------------------------------

library(here)
library(ghibli)
library(xaringanthemer)

```

```{r xaringan_themer, include = FALSE}

mono_light(
  base_color = ghibli_palette("MononokeDark")[3],
  header_font_google = google_font("Amatic SC", "400b"),
  header_h1_font_size = "80px",
  header_h2_font_size = "60px",
  header_h3_font_size = "50px",
  header_font_weight = "bold",
  text_font_google   = google_font("Montserrat", "400", "400i", "400b"),
  text_font_size = "26px",
  code_font_google   = google_font("Droid Mono"),
  padding = "0em 2em 1em 2em",
  footnote_color = "#666666",
  footnote_font_size = "0.5em",
  footnote_position_bottom = "0.5em"
)

```

class: inverse, center, bottom

# 'Start with the end in mind.'

---

<br />
<br />

What is the decision in need of evidence?

--

How will you make the decision with no additional information?

--

How would you make the decision if you had access to any information you wanted?

--

Can you get access to all the data you ideally want to make your decision?

--

What mistakes are you willing to live with?

--

.footnote[
[1] Argyris, 1976, ['Single-loop and double-loop models in research on decision-making'](http://academic.udayton.edu/richardghere/igo%20ngo%20research/argyris.pdf), _Administrative Science Quarterly_

[2] Byrne, 2018, ['Why Google defind a new discipline to help humans make decisions'](https://www.fastcompany.com/90203073/why-google-defined-a-new-discipline-to-help-humans-make-decisions), _Fast Company_
]

---
class: inverse, center, bottom

# Working with data // Coding with data

---

# Excel: Its power and its pitfalls

--

1. Data, analysis outputs, and visualisation are stored in one place.

--

2. Data is easily manipulated - high risk of introducing errors.

--

3. Point-and-click interface - manual repetition!

--

4. Actions are not logged by default.

--

5. Slow when working with large data sets or files storing many computations.

--

6. Complicated workbooks can 'break' when shared with others.

---

# The case for coding

--

1. Separation of data, analysis outputs, visualisations, and reports.

--

2. Reproducible, transparent, and less error-prone workflow.

--

3. Coding methods are faster for repetitive actions than point-and-click.

--

4. Procedures are documented via scripts and command history.

--

5. Build your own library of frequently used analytical procedures - or use and adapt libraries created by open source developers!

---
class: inverse, center, bottom

# A worked example with sports data
## Summarising data from the Winter Olympics

---

<br />
Demo 1 uses the `winter` data set downloadable from this link: https://www.kaggle.com/the-guardian/olympic-games/data

It includes all podium results from Winter Olympic Games that have taken place from 1924 to 2014, inclusive.

<center>
<img src="https://raw.githubusercontent.com/jacquietran/2019_essa_forum/master/images/ChloeKim.jpg" width="600px" />
</center>

---

# Import the data

``` {r demo1_import_data, message = FALSE}

# The {readr} package is efficient for reading (importing) CSVs
library(readr)

# Read the data in
winter <- read_csv(
  here("data/winter.csv"), col_names = TRUE, col_types = NULL)

```

---

# Check the data

``` {r demo1_check_data, eval = FALSE}

head(winter)

```

--

``` {r demo1_check_data_eval, eval = TRUE, echo = FALSE}

# This code chunk won't show on the slide but
# the code will evaluate to print the first 6 rows of data
# allowing for separation of the code chunk from its result
head(winter)

```

---

# Subset the data

Let's say we are interested in comparing the **number of gold medals won** by **Canada, Norway, and Sweden** from the **last five Winter Olympic Games**.

--

We need to subset the data to focus only on:

- Gold medal results

--

- Athletes from Canada (CAN), Norway (NOR), or Sweden (SWE), and

--

- Results from the last five Winter Olympics (1998 to 2014)

---

# Subset the data

``` {r demo1_subset_data}

# The {dplyr} package includes useful data manipulation functions
library(dplyr)

# Subset the data
gold_medal_comparison <- winter %>%
  filter(Medal == "Gold"
         & Country %in% c("CAN", "NOR", "SWE")
         & Year >= 1998)

```

---

# Check the data

``` {r demo1_check_subset}

gold_medal_comparison

```

---

# Wrangle the data

In the `winter` data set, the data is structured such that **one row is one medal-winning athlete**.

However...

--

- Team events (e.g., bobsleigh) comprise multiple athletes, and

--

- Within teams that achieve a podium finish, each athlete is awarded a medal.

--

For this analysis, we need to wrangle the data to get it into a format where **one row represents one gold medal per event** (rather than per athlete).

---

# Wrangle the data

``` {r demo1_wrangle_data_part_1}

# Create a new variable to identify each unique event
gold_medal_comparison$unique_event_ID <-
  paste(gold_medal_comparison$Year,
        gold_medal_comparison$Sport,
        gold_medal_comparison$Discipline,
        gold_medal_comparison$Country,
        gold_medal_comparison$Gender,
        gold_medal_comparison$Event, sep="_")

```

---

# Wrangle the data

``` {r demo1_wrangle_data_part_2}

gold_medal_comparison %>%
  select(unique_event_ID)

```

---

# Wrangle the data

``` {r demo1_wrangle_data_part_3}

# Identify duplicates
gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  select(unique_event_ID, duplicates)

```

---

# Wrangle the data

``` {r demo1_wrangle_data_part_4}

# Remove duplicates from the data and
# remove temporary variables used to identify duplicates
gold_medal_comparison %>%
  mutate(duplicates = duplicated(unique_event_ID)) %>%
  filter(duplicates == FALSE) %>%       #<<
  select(-unique_event_ID, -duplicates) #<<

```

---

# Wrangle the data

``` {r demo1_wrangle_data_part_5}

gold_medal_comparison %>%
  select(Year, Sport, Country, Event)

```

---

# Calculate summary statistics

The data is now in a format that is ready for calculating summary statistics.

For instance, we can tabulate the total number of gold medals won by Canada, Norway, and Sweden at each of the Winter Games since 1998.

---

# Calculate summary statistics

``` {r demo1_summary_stats_part_1, message = FALSE}

# The reshape2 package is useful for manipulating data
# from long-to-wide format and vice versa
library(reshape2)

# Calculate total number of gold medals per team per Winter Games
gold_medal_totals <- gold_medal_comparison %>%
  group_by(Year, City, Country) %>%
  summarise(gold_medal_total = length(Medal)) %>%
  ungroup()

# Reshape the data from long-to-wide format for tabulating
gold_medal_totals_wide <- dcast(
  gold_medal_totals,
  Year + City ~ Country,
  value.var = "gold_medal_total")

```

---

# Calculate summary statistics

``` {r demo1_summary_stats_part_2}

# Check the reshaped data
gold_medal_totals_wide

```

``` {r demo1_summary_stats_part_3}

# NAs appear in the data because Sweden did not win any gold medals
# at the 1998 and 2002 Winter Games

# Replace these NAs with zeroes
gold_medal_totals_wide[is.na(gold_medal_totals_wide)] <- 0

```

---

# Display summary statistics

``` {r demo1_summary_stats_part_4, eval = FALSE}

# The DT package is used to display interactive tables in HTML documents
library(DT)

# Display the table
datatable(gold_medal_totals_wide, options = list(dom = 't'), rownames = FALSE)

```

---

# Display summary statistics

``` {r demo1_summary_stats_part_5, eval = TRUE, echo = FALSE, warning = FALSE}

# This code chunk won't display on the slide but
# the code will evaluate to display summary stats
# in an interactive HTML table
library(DT)

datatable(gold_medal_totals_wide,
          fillContainer = FALSE,
          options = list(dom = 't'),
          rownames = FALSE)

```

---

# Calculate summary statistics

We can use the data frame we've just created - gold medal totals per team per Games - to calculate the median number of gold medals won by Canada, Norway, and Sweden at the last five Games.

``` {r demo1_summary_stats_part_6}

gold_medal_medians <- gold_medal_totals_wide %>%
  summarise(CAN = median(CAN),
            NOR = median(NOR),
            SWE = median(SWE))

gold_medal_medians

```

---

# Section subheader

Slide body text

``` {r eval = FALSE, tidy = FALSE}

# Some code I put here for aesthetic purposes ----------------------------------

devtools::install_github("yihui/xaringan")

```

---
class: inverse, center, bottom

# Developing data proficiency

---
class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).